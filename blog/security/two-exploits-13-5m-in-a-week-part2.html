<!DOCTYPE html>
<html lang="en">

<head>
    <!-- meta tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>$13.3M Lost in a Week: Two Protocol Exploits</title>
    <meta name="description"
        content="Two DeFi exploits drained $13.3M in a week—root causes, attack paths, timelines, on-chain evidence, fixes, and preventive controls developers can apply.">
    <meta name="keywords"
        content="DeFi, Exploits, Uniswap, BetterBank,  smart contract security, Ethereum security, Web3 security, exploit analysis, hack postmortem, incident response, on-chain forensics, transaction trace, vulnerability, attack vector, protocol exploit, protocol hack, $13.3M loss, two exploits one week, root cause analysis, remediation, mitigation, best practices, secure coding, Solidity security, reentrancy, re-entrancy, access control bug, unauthorized access, role misconfiguration, RBAC, Ownable, Pausable, timelock, pause guardian, circuit breaker, flash loan, flashloan attack, price oracle manipulation, oracle spoofing, TWAP, unsafe oracle, MEV, front-running, sandwich attack, slippage manipulation, signature replay, permit abuse, EIP-2612, EIP-712, unchecked return value, integer overflow, integer underflow, arithmetic bug, unchecked call, delegatecall risk, selfdestruct risk, tx.origin misuse, timestamp dependency, randomness weakness, upgradeable proxy, TransparentUpgradeableProxy, UUPS, Beacon proxy, Diamond pattern, storage collision, initialization bug, proxy upgrade risk, emergency shutdown, bug bounty, disclosure, audit findings, audit remediation, static analysis, dynamic analysis, fuzz testing, invariant testing, formal verification, unit tests, Foundry, Hardhat, Slither, Echidna, Mythril, Tenderly, Etherscan, OpenZeppelin, code review, gas optimization, defense in depth, threat modeling, risk management, TVL drain, liquidity pool exploit, approval phishing, allowance escalation, access list, multisig safeguards, monitoring, alerting, anomaly detection, postmortem, lessons learned, secure smart contract">
    <meta name="author" content="Sasha Flores">
    <meta property="og:type" content="website">



    <!-- Bootstrap CSS -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/aos.css" rel="stylesheet">
    <link href="../../css/navbar.css" rel="stylesheet">
    <link href="../../css/new-common-articles.css" rel="stylesheet">
    <link href="../../css/footer.css" rel="stylesheet">




    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MXTX916K7T"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-MXTX916K7T');
    </script>
</head>


<body class="page-offset">
    <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
            <div class="container-fluid px-md-5">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0" data-aos="fade-down" data-aos-duration="1000">
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="../../index.html">HOME</a>
                        </li>

                        <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="aboutDropdown"
                                role="button" data-bs-toggle="dropdown" aria-expanded="false">ABOUT ME</a>
                            <ul class="dropdown-menu" aria-labelledby="aboutDropdown">
                                <li><a class="dropdown-item" href="../../background.html">Background</a></li>
                                <li><a class="dropdown-item" href="../../skills.html">Skills</a></li>
                                <li><a class="dropdown-item" href="../../experience.html">Experience</a></li>
                            </ul>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="../../portfolio.html">PORTFOLIO</a></li>
                        <li class="nav-item"> <a class="nav-link active" href="../blog.html">BLOG</a></li>
                        <li class="nav-item"><a class="nav-link" href="../../contact.html">CONTACT</a></li>
                    </ul>

                    <div class="nav-cta">
                        <button type="button" class="nav-cta__btn" data-connect-trigger aria-haspopup="dialog" aria-controls="walletModal">CONNECT</button>
                        <button type="button" class="nav-cta__btn nav-cta__btn--accent" data-subscribe-trigger aria-haspopup="dialog" aria-controls="subscribeModal">SUBSCRIBE</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="article-container">
        <h1 id="title">Two Exploits in a Span of a Week: How $13.3M Vanished Across BetterBank & Bunni v4</br>Part Two</h1>
        <figure class="meta-video">
            <video class="article-hero-video" autoplay muted loop playsinline preload="auto"
                aria-label="Looping hero animation">
                <source src="../../images/blog/security/two-exploits-13-5m-in-a-week/animation.mp4" type="video/mp4">
            </video>
            <p class="caption">Bunni V2 Exploit on September 2, 2025</p>
        </figure>

                        <div class="article-stats" data-post-id="two-exploits-part2">
            <button class="stat-mint" type="button" aria-label="Mint placeholder">
                <ion-icon name="sparkles-outline"></ion-icon>
                <span>Mint Incoming</span>
            </button>
            <div class="stat-group">
                <button type="button" class="stat" data-role="like">
                    <ion-icon name="thumbs-up-outline"></ion-icon>
                    <span class="stat-number">0</span>
                </button>
                <div class="stat stat-view">
                    <ion-icon name="eye-outline"></ion-icon>
                    <span class="stat-number">0</span>
                </div>
            </div>
        </div>

        <h2 class="title t-2">Introduction to Bunni V2 Protocol</h2> 
        
        <p>
            <a href="https://bunni.xyz/" target="_blank" rel="">Bunni</a> is liquidity protocol built on Uniswap V4 but instead of integrating 
            liquidity curve of Uniswap, it customized it's own curve by utilizing the new hooks feature introduced in V4 to develop 
            <a href="https://github.com/Bunniapp/bunni-v2/blob/main/src/ldf/UniformDistribution.sol" target="_blank" rel="">UniformDistribution</a> equivalent to 
            uniswap V3 position where it recomputes the idle balance of the pool after each trade 
            <a href="https://github.com/Bunniapp/bunni-v2/blob/ad8acfc30249da5a63450adf4a92c946c260e9de/src/lib/BunniHookLogic.sol#L600" target="_blank" rel="">BunniHookLogic</a> 
            to detect if the curve has a liquidity surplus, if found it rebalance the liquidity pool to maintain the curve in the correct tokens ratio. 
        </p> 
        
        <h2 class="title t-2">How the Attacker Exploit the Protocol</h2>
        
        <p> 
            The exploit targeted this rebalance mechanism. By crafting a sequence of swaps, the attacker tricked the hook into 
            miscalculating surplus, causing it to distribute more output tokens than intended. This logical flaw allowed the attacker to drain ~$8.3M from the pool. 
        </p>

        <ul>
            <li>Attacker created the first malicious contract using EAO: 0x0c3d8fa7762ca5225260039ab2d3990c035b458d</li>
            <figure class="a-figure zoom-m">
                <img alt="medium zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/firstContract.png">
            </figure>
            <li>
                With the same EOA, created another malicious contract
                <figure class="a-figure zoom-m">
                    <img alt="medium zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/SecondContract.png">
                </figure>
            </li>
        </ul>

        <ul>
            <li>Using his second malicious contract address to take a flash loan of 3M UST from Uniswap v3 on Ethereum.</li>
            <figure class="a-figure zoom-m">
                <img alt="medium zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/flashLoan.png">
            </figure>
        </ul>

        <ul>
            <li>If we expand the flash loan transaction to see all internal transfers and interactions across all involved protocols:</li>
            <ul>
                <li>
                    <code>Line 41:</code> <code class="inline-snippet">BunniHub</code> contract identified the <code class="inline-snippet">poolId</code> to capture the <code class="inline-snippet">poolState</code> and return <code class="inline-snippet">liquidityDensityFunction</code> parameters
                </li>
                <li>
                    <code>Line 42:</code> attacker took a USDT flash loan from Uniswap v3 for $3M <code class="inline-snippet">amount1=3,000,000,000,000</code>.
                </li>
                <li>
                    <code>Line 43:</code> returns balance of WETH <code class="inline-snippet">amount0</code> in Uniswap v3.
                </li>
                <li>
                    <code>Line 44:</code> returns balance of USDT <code class="inline-snippet">amount1</code> in Uniswap v3.
                </li>
                <li>
                    <code>Line 45:</code> Uniswap executes USDT transfer of flash loan amount on USDT contract.
                </li>
                <li>
                    <code>Line 46:</code> USDT contract emits <code class="inline-snippet">Transfer</code> event with <code class="inline-snippet">from</code> Uniswap, <code class="inline-snippet">to</code> attacker's second malicious contract, 
                    and <code class="inline-snippet">value</code> is the $3M flash loan amount.
                </li>
                <li>
                    <code>Line 47:</code> <code class="inline-snippet">uniswapV3FlashCallback</code> enforce flash loan repayment in same transaction, in total of $9M that
                    include principle plus fee where <code class="inline-snippet">fee1=9,000,000,000,000</code> of <code class="inline-snippet">amount1</code> earlier.
                </li>
                <li>
                    <code>Line 48:</code> <code class="inline-snippet">uniswapV3FlashCallback</code> emits a <code class="inline-snippet">log_string</code> event (“Depositing to euler”).
                </li>
                <li>
                    <code>Line 49:</code> since Bunni v2 is using Hooks and built on Uniswap v4, all transactions except pool initiation without funding 
                    has to unlock <code class="inline-snippet">poolManager</code> prior to executing trade via <code class="inline-snippet">unlockCallback</code>.
                </li>
                <li>
                    <code>Line 50:</code> flash loan recipient contract executes <code class="inline-snippet">unlockCallback</code>.
                </li>
                <li>
                    <code>Line 51:</code> emits <code class="inline-snippet">unlockCallback</code> event on successful call.
                </li>
                <figure class="a-figure zoom-l">
                    <img alt="large zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/flashLoanExpanded.png">
                </figure>
            </ul>
        </ul>
        

        <ul>
            <li>
                To manipulate the <code class="inline-snippet">UniformDistribution</code> attacker executed a series of swaps on USDC-USDT pool, to trigger the 
                flaw of Bunni Hook liquidity accounting mechanism that successfully yield more output token.
            </li>
            <ul>
                <li>
                    Every swap executed triggered <code class="inline-snippet">beforeSwap</code> hook that captured Bunni's pool pair ratio before swap, while internally 
                    there are 2 operations taking place for a successful swap; Uniswap v4 Flash Accounting and Bunni's Uniform Distribution.
                </li>
                <figure class="a-figure zoom-l">
                    <img alt="large zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/swap1.png">
                </figure>
                <li>
                    With each swap and with the distribution function miscalculation of delta after each swap, the error got accumulated because of Uniswap 
                    flash accounting in favor of attacker as a positive balance to withdraw.
                </li>
                <figure class="a-figure zoom-l">
                    <img alt="large zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/swap2.png">
                </figure>
            </ul>
        </ul>

        <ul>
            <li>
                Final exploit in Bunni's protocol was to withdraw <code class="inline-snippet">take</code> the compounded balance and pay off <code class="inline-snippet">settle</code> the flash loan.
            </li>
            <figure class="a-figure zoom-l">
                <img alt="large zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/takeSyncSettle.png">
            </figure>
        </ul>

        <ul>
            <li>
                Attacker used another EOA `0xe04efd87f410e260cf940a3bcb8bc61f33464f2b` to deposit $1.4M USDT and $1.32M USDC in Aave v3
            </li>
            <figure class="a-figure zoom-l">
                <img alt="large zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/aave.png">
            </figure>
        </ul>

        <ul>
            <li><strong>Till the time writing this post, exploit amounts are still in attacker's EOAs as follow:</strong></li>
            <ul>
                <li>
                    <a href="https://etherscan.io/address/0x18a0aa63c07534f69ad626e6f72f20cbe5969263" target="_blank" rel=""> 0x18a0Aa63C07534f69aD626E6F72f20Cbe5969263</a>
                </li>
                <fig class="a-figure zoom-m">
                    <img alt="medium zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/acc1.png">
                </fig>
                <li>
                    <a href="https://etherscan.io/address/0x0c3d8fa7762ca5225260039ab2d3990c035b458d#asset-tokens" target="_blank" rel=""> 0x0C3d8fA7762Ca5225260039ab2d3990C035B458D</a>
                </li>
                <fig class="a-figure zoom-m">
                    <img alt="medium zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/acc2.png">
                </fig>
                <li>
                    <a href="https://etherscan.io/address/0xe04efd87f410e260cf940a3bcb8bc61f33464f2b#asset-tokens" target="_blank" rel=""> 0xE04eFD87F410e260cf940a3bcb8BC61f33464f2b</a>
                </li>
                <fig class="a-figure zoom-m">
                    <img alt="medium zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/acc3.png">
                </fig>
            </ul>
        </ul>

        <h2 class="title t-2">Hack Analysis</h2>
        <p>
            Bunni's Uniform Distribution of liquidity miscalculated balance after each trade that goes through Uniswap v4, didn't count properly
            for flash accounting and deltas which left change or small amounts to be exploit by accumulation, if a well sized swap executed repeatedly. 
        </p>
        <fig class="a-figure zoom-xl">
            <img alt="x-large zoom" src="../../images/blog/security/two-exploits-13-5m-in-a-week-part2/fundFlow.png">
            <figcaption> Exploit Funds Flow</figcaption>
        </fig>


    </div>

    <form name="subscribe-form" method="POST" data-netlify="true" netlify-honeypot="bot-field" hidden>
        <input type="hidden" name="form-name" value="subscribe-form">
        <input type="text" name="bot-field">
        <input type="email" name="email">
    </form>

    <div class="modal-overlay" data-subscribe-modal hidden>
        <div class="modal-window" role="dialog" aria-modal="true" aria-labelledby="subscribeModalTitle">
            <button type="button" class="modal-close" data-close-subscribe aria-label="Close subscribe dialog">&times;</button>
            <h3 id="subscribeModalTitle" class="modal-title">Receive new articles directly in your inbox</h3>
            <form class="modal-form" data-subscribe-form>
                <label class="visually-hidden" for="subscribe-email">Email</label>
                <input type="email" id="subscribe-email" name="email" placeholder="enter your email" autocomplete="email" required>
                <span class="input-hint" data-subscribe-hint></span>
                <button type="submit" class="modal-submit" data-subscribe-submit disabled>subscribe</button>
                <p class="submit-feedback" data-subscribe-feedback role="status" aria-live="polite"></p>
            </form>
        </div>
    </div>

    <div class="modal-overlay" data-connect-modal hidden>
        <div class="modal-window modal-window--wallet" role="dialog" aria-modal="true" aria-labelledby="walletModalTitle" id="walletModal">
            <button type="button" class="modal-close" data-close-connect aria-label="Close wallet dialog">&times;</button>
            <h3 id="walletModalTitle" class="modal-title">Connect your wallet</h3>
            <p class="modal-intro">Select a wallet provider to continue. (Wallet integration coming soon.)</p>
            <ul class="wallet-list">
                <li><button type="button" class="wallet-button" data-wallet="metamask">MetaMask</button></li>
                <li><button type="button" class="wallet-button" data-wallet="coinbase">Coinbase Wallet</button></li>
                <li><button type="button" class="wallet-button" data-wallet="trust">Trust Wallet</button></li>
                <li><button type="button" class="wallet-button" data-wallet="phantom">Phantom</button></li>
                <li><button type="button" class="wallet-button" data-wallet="rainbow">Rainbow</button></li>
                <li><button type="button" class="wallet-button" data-wallet="ledger">Ledger Live</button></li>
            </ul>
            <p class="wallet-placeholder-note">Connection support will arrive soon. For now, this list is a visual placeholder.</p>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Sasha Flores. All Rights Reserved.</p>
            <div class="social-links">
                <a href="https://www.linkedin.com/in/sflores369/" target="_blank"><ion-icon
                        name="logo-linkedin"></ion-icon></a>
                <a href="https://discord.com/users/827160247428710422" target="_blank"><ion-icon
                        name="logo-discord"></ion-icon></a>
                <a href="https://github.com/SashaFlores" target="_blank"><ion-icon name="logo-github"></ion-icon></a>
                <a href="https://www.youtube.com/@web3securityengineer" target="_blank"><ion-icon name="videocam-sharp"></ion-icon><span class="tooltip"></span></a>
            </div>
        </div>
    </footer>
    
    
    
    <script src="../../js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../js/aos.js"></script>
    <script src="../../js/custom.js"></script>
    <script src="../../js//code-copy.js"> </script>
    <script src="../../js/post-slugs.js" defer></script>
    <script src="../../js/post-stats.js" defer></script>
    <script src="../../js/nav-cta.js" defer></script>

    <script type="module" src="https://unpkg.com/ionicons@latest/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule="" src="https://unpkg.com/ionicons@latest/dist/ionicons/ionicons.js"></script>

</body>
</html>
